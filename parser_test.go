package sniparser

import (
	"strings"
	"testing"
)

func TestParseServerName(t *testing.T) {
	buffers, serverName, err := ReadServerName(strings.NewReader(clientHello))
	if err != nil {
		t.Fatal(err)
	}
	if expected := "www.google.com"; serverName != expected {
		t.Fatalf("Bad servername, expected %s got %s", expected, serverName)
	}
	size := 0
	for _, buf := range buffers {
		size += len(buf)
	}
	if size != len(clientHello) {
		t.Fatal("Read incorrect number of bytes")
	}
}

var clientHello = "\x16\x03\x01\x01\t\x01\x00\x01\x05\x03\x03Yt\xd9>\x86\x8b\xb2\xf1dkY?\xef4\xe1!\xe3\xecZ\x19Z\x03\xd9)\xc6\xd3z(ez]\xe8\x00\x00l\xc0+\xc0,\xc0\x86\xc0\x87\xc0\t\xc0#\xc0\n\xc0$\xc0r\xc0s\xc0\xac\xc0\xad\xc0\x08\xc0/\xc00\xc0\x8a\xc0\x8b\xc0\x13\xc0'\xc0\x14\xc0(\xc0v\xc0w\xc0\x12\x00\x9c\x00\x9d\xc0z\xc0{\x00/\x00<\x005\x00=\x00A\x00\xba\x00\x84\x00\xc0\xc0\x9c\xc0\x9d\x00\n\x00\x9e\x00\x9f\xc0|\xc0}\x003\x00g\x009\x00k\x00E\x00\xbe\x00\x88\x00\xc4\xc0\x9e\xc0\x9f\x00\x16\x01\x00\x00p\x00\x17\x00\x00\x00\x16\x00\x00\x00\x05\x00\x05\x01\x00\x00\x00\x00\x00\x00\x00\x13\x00\x11\x00\x00\x0ewww.google.com\xff\x01\x00\x01\x00\x00#\x00\x00\x00\n\x00\x0c\x00\n\x00\x17\x00\x18\x00\x19\x00\x15\x00\x13\x00\x0b\x00\x02\x01\x00\x00\r\x00\x16\x00\x14\x04\x01\x04\x03\x05\x01\x05\x03\x06\x01\x06\x03\x03\x01\x03\x03\x02\x01\x02\x03\x00\x10\x00\x0b\x00\t\x08http/1.1"
